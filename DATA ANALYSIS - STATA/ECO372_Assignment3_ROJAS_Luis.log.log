----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\luisr\Desktop\3RD YEAR\ECO 372\Assignment 3\ECO372_Assignment3_ROJAS_Luis.log
  log type:  text
 opened on:   4 Dec 2019, 17:29:56

. set more off    // This tells Stata to automatically continue if displays exceed screen capacity, instead of making user click

. clear                   // Removes any data from memory every time this script is run.

. display "ECO372_Assignment3 " _n "`surname' `firstname' `studentnumber'" _n c(current_date) c(current_time)
ECO372_Assignment3 
ROJAS Luis 1003650676
 4 Dec 201917:29:56

. 
. /*      =============================================================
>         ============ EXERCISE 1 ============
>         ============================================================= */
. 
. use "datasets/Dynarski2003.dta", clear                  

. datasignature                                                                   // checks data integrity                                                                                                      
>   
  3986:8(47182):2823322766:1689484522

. 
. // YOUR COMMANDS FOR EXERCISE 1 GO HERE
. 
. describe //to know the variables to be analized 

Contains data from datasets/Dynarski2003.dta
  obs:         3,986                          
 vars:             8                          20 Mar 2018 11:52
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
id              int     %9.0g                 identification code (1-12686) 7
hhid            int     %9.0g                 hh identification number 79
wt88            float   %9.0g                 sampling weight 88
coll            byte    %9.0g                 Full-time college by age 23
hgc23           byte    %9.0g                 Highest grade completed by age 23
yearsr          byte    %9.0g                 Year in which a senior
fatherdec       byte    %19.0g     dec        Father deceased by age 18
offer           float   %9.0g                 Senior in year SSSB support available
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Sorted by: id

. count //to know the number of observations
  3,986

. tab offer //to know how the data is distributed 

  Senior in |
  year SSSB |
    support |
  available |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,104       27.70       27.70
          1 |      2,882       72.30      100.00
------------+-----------------------------------
      Total |      3,986      100.00

. tab yearsr 

    Year in |
    which a |
     senior |      Freq.     Percent        Cum.
------------+-----------------------------------
         79 |        933       23.41       23.41
         80 |      1,030       25.84       49.25
         81 |        919       23.06       72.30
         82 |        869       21.80       94.10
         83 |        235        5.90      100.00
------------+-----------------------------------
      Total |      3,986      100.00

. 
.         //QUESTION B 
.         
. gen SrBeforeElimination = c.yearsr <= 81 //create a dummy equal 1 if graduated when benefits available

. label variable SrBeforeElimination "Before"

. 
. tab SrBeforeElimination

     Before |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,104       27.70       27.70
          1 |      2,882       72.30      100.00
------------+-----------------------------------
      Total |      3,986      100.00

. 
.         //QUESTION C 
.         
. table SrBeforeElimination [weight=wt88], by(fatherdec) contents (mean coll mean hgc23) //This creates a table where means are columns and the 2 other variables rows
(frequency weights assumed)

----------------------------------------------
Father deceased by  |
age 18 and Before   |  mean(coll)  mean(hgc23)
--------------------+-------------------------
Father not deceased |
                  0 |    .4756936     13.25053
                  1 |    .5017017     13.41341
--------------------+-------------------------
Father deceased     |
                  0 |    .3522178     12.90348
                  1 |    .5604556     13.44166
----------------------------------------------

. 
.         //QUESTION D
.         
. reg coll SrBeforeElimination##fatherdec [weight=wt88], cluster(hhid) // Diff-in-Diff regression, you need to cluster to the household level to count for correlation for students within the same household
(analytic weights assumed)
(sum of wgt is 1,302,933,368)

Linear regression                               Number of obs     =      3,986
                                                F(3, 3122)        =       2.19
                                                Prob > F          =     0.0875
                                                R-squared         =     0.0020
                                                Root MSE          =     .49973

                                                (Std. Err. adjusted for 3,123 clusters in hhid)
-----------------------------------------------------------------------------------------------
                              |               Robust
                         coll |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
        1.SrBeforeElimination |   .0260081   .0212723     1.22   0.222    -.0157011    .0677173
                              |
                    fatherdec |
             Father deceased  |  -.1234757   .0834565    -1.48   0.139    -.2871109    .0401595
                              |
SrBeforeElimination#fatherdec |
           1#Father deceased  |   .1822297   .0958771     1.90   0.057    -.0057589    .3702183
                              |
                        _cons |   .4756935    .018872    25.21   0.000     .4386907    .5126964
-----------------------------------------------------------------------------------------------

. estimates store Diff            //to store the results of the regression useful to be used latter on plotting nice output tables

.  
. //Creating a nice output table will require to drop variables not needen
. esttab  Diff using "Table 2 Replication", ///
>         rtf replace se label ///
>         mtitles("Difference-in-Differences") ///
>         stats(N r2 F, labels("Observations" "R-squared" "F-statistic")) ///
>         drop(0.SrBeforeElimination 0.fatherdec 0.SrBeforeElimination*0.fatherdec 1.SrBeforeElimination*0.fatherdec 0.SrBeforeElimination*1.fatherdec)   // use "///" when you want to continue adding edits to
>  the table otherwise the program will end up 
(output written to Table 2 Replication.rtf)

. 
. 
. 
. /*      =============================================================
>         ============ EXERCISE 2 ============
>         ============================================================= */
. // Do not change those initial commands
. clear

. set seed `studentnumber'

. set obs 1000
number of observations (_N) was 0, now 1,000

. gen workerID = _n

. display "Student nb: `studentnumber'"
Student nb: 1003650676

. 
. // YOUR COMMANDS FOR EXERCISE 2 GO HERE
. 
. gen byte cityA = (runiform() < 0.6) //Allocate 60% of workers in city A

. label variable cityA "Number of workers in city A"

. gen byte cityB = 1 - cityA // Allocate 40% of workers in city B

. label variable cityB "Number of workers in city B"

. 
. 
. expand 7, generate (expandy)
(6,000 observations created)

. sort workerID expandy 

. bysort workerID: gen year = 2012+ _n -1 //creates year

. drop expandy

. 
. tab cityB

  Number of |
 workers in |
     city B |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      4,200       60.00       60.00
          1 |      2,800       40.00      100.00
------------+-----------------------------------
      Total |      7,000      100.00

. tab year 

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2012 |      1,000       14.29       14.29
       2013 |      1,000       14.29       28.57
       2014 |      1,000       14.29       42.86
       2015 |      1,000       14.29       57.14
       2016 |      1,000       14.29       71.43
       2017 |      1,000       14.29       85.71
       2018 |      1,000       14.29      100.00
------------+-----------------------------------
      Total |      7,000      100.00

. 
.         //QUESTION C 
.         
. gen POST = c.year >= 2016 //Creates a dummy variable =1 for observations in year 2016+

. label variable POST "Dummy variable for observations in year 2016 and following"

. tab POST //to know the distribution and exactness of the new variable

      Dummy |
   variable |
        for |
observation |
  s in year |
   2016 and |
  following |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      4,000       57.14       57.14
          1 |      3,000       42.86      100.00
------------+-----------------------------------
      Total |      7,000      100.00

. 
.         
. gen HQ = cityB*POST //this interaction variable allow us to know the amount of observations in city B after the 2016, where the new headquarter came to town 

. label variable HQ "City with BIG Headquarters, 2016+"

. tab HQ 

  City with |
        BIG |
Headquarter |
   s, 2016+ |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      5,800       82.86       82.86
          1 |      1,200       17.14      100.00
------------+-----------------------------------
      Total |      7,000      100.00

.         //QUESTION D 
.         
. gen u = rnormal(0, 1.5) if cityA == 1 //error term comes random numbers from a normal distribution mean 0 and sd 1.5
(2,800 missing values generated)

. label variable u "White Noise, different for each city"

. replace u = rnormal(0,1) if cityB == 1 // for city b error term comes from random numbers from a normal distribution mean 0 and sd 1
(2,800 real changes made)

. 
.         //QUESTION E 
.         
. gen ys2012 = year-2012 // creates a variable that means amount of years passed since 2012

. label variable ys2012 "years passed since 2012"

. tab ys2012 

      years |
     passed |
 since 2012 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,000       14.29       14.29
          1 |      1,000       14.29       28.57
          2 |      1,000       14.29       42.86
          3 |      1,000       14.29       57.14
          4 |      1,000       14.29       71.43
          5 |      1,000       14.29       85.71
          6 |      1,000       14.29      100.00
------------+-----------------------------------
      Total |      7,000      100.00

. 
. 
.         //QUESTION F 
.         
. gen w = 10 +1.3 * (HQ) + 0.2 * (ys2012*cityA) + 0.6 * (ys2012*cityB) + u // generating variable w with the given coefficients

. label variable w "Hourly Wages with the given coefficients"

. 
.         //QUESTION G
.         
. describe 

Contains data
  obs:         7,000                          
 vars:             9                          
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
workerID        float   %9.0g                 
cityA           byte    %8.0g                 Number of workers in city A
cityB           byte    %8.0g                 Number of workers in city B
year            float   %9.0g                 
POST            float   %9.0g                 Dummy variable for observations in year 2016 and following
HQ              float   %9.0g                 City with BIG Headquarters, 2016+
u               float   %9.0g                 White Noise, different for each city
ys2012          float   %9.0g                 years passed since 2012
w               float   %9.0g                 Hourly Wages with the given coefficients
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Sorted by: workerID
     Note: Dataset has changed since last saved.

. drop (HQ u ) // drop the variables here to analize the data set as a researcher

. describe 

Contains data
  obs:         7,000                          
 vars:             7                          
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
workerID        float   %9.0g                 
cityA           byte    %8.0g                 Number of workers in city A
cityB           byte    %8.0g                 Number of workers in city B
year            float   %9.0g                 
POST            float   %9.0g                 Dummy variable for observations in year 2016 and following
ys2012          float   %9.0g                 years passed since 2012
w               float   %9.0g                 Hourly Wages with the given coefficients
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Sorted by: workerID
     Note: Dataset has changed since last saved.

. 
.         //QUESTION J 
.         
. reg w cityB##POST, robust //this regression fails to capture true effect of big headquarters since starts only from 2016, while we have data even from 2012 +4000 observations not considered.

Linear regression                               Number of obs     =      7,000
                                                F(3, 6996)        =    3450.66
                                                Prob > F          =     0.0000
                                                R-squared         =     0.5165
                                                Root MSE          =     1.3641

------------------------------------------------------------------------------
             |               Robust
           w |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     1.cityB |    .566042    .042403    13.35   0.000     .4829192    .6491648
      1.POST |   .7432085   .0466444    15.93   0.000     .6517714    .8346456
             |
  cityB#POST |
        1 1  |   2.730324   .0634366    43.04   0.000     2.605969    2.854679
             |
       _cons |   10.27439    .030471   337.19   0.000     10.21466    10.33412
------------------------------------------------------------------------------

. 
.         //Question K
. 
. reg w POST##cityB c.ys2012##cityB, robust // this regreassion captures the true casual effect when includes the changing of wages overtime

Linear regression                               Number of obs     =      7,000
                                                F(5, 6994)        =    2683.14
                                                Prob > F          =     0.0000
                                                R-squared         =     0.5581
                                                Root MSE          =     1.3043

--------------------------------------------------------------------------------
               |               Robust
             w |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
        1.POST |   .0299584   .0912417     0.33   0.743     -.148903    .2088198
       1.cityB |   .0003292   .0589231     0.01   0.996    -.1151779    .1158363
               |
    POST#cityB |
          1 1  |   1.410327   .1186689    11.88   0.000       1.1777    1.642954
               |
        ys2012 |   .2037857   .0225522     9.04   0.000     .1595765     .247995
               |
cityB#c.ys2012 |
            1  |   .3771419   .0294297    12.82   0.000     .3194508    .4348329
               |
         _cons |    9.96871   .0454355   219.40   0.000     9.879643    10.05778
--------------------------------------------------------------------------------

. 
. 
. //stop
. 
. 
. 
. /*      =============================================================
>         ============    FINAL COMMANDS  (do not change) ============
>         ============================================================= */
.         
. log close
      name:  <unnamed>
       log:  C:\Users\luisr\Desktop\3RD YEAR\ECO 372\Assignment 3\ECO372_Assignment3_ROJAS_Luis.log
  log type:  text
 closed on:   4 Dec 2019, 17:29:58
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
